<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/styles/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/poole_hyde.css"> <link rel=stylesheet  href="/css/sisap.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 768px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/assets/favicon.png"> <title>Downloading the LAION2B Dataset</title> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <img alt="sisap logo" src="https://www.sisap.org/2023/images/sisap.png" /> <h1><a href="/">SISAP Indexing challenge</a></h1> <p class=lead >challenge</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/">Home</a> <!--a class="sidebar-nav-item {{ispage 2025/evaluationmethodology/*}}active{{end}}" href="/2025/evaluationmethodology/">Methodology</a> <a class="sidebar-nav-item {{ispage 2025/datasets/*}}active{{end}}" href="/2025/datasets/">Datasets</a> <a class="sidebar-nav-item {{ispage 2025/repoexamples/*}}active{{end}}" href="/2025/repoexamples/">Repository examples</a> --> <!--a class="sidebar-nav-item {{ispage ioformats/*}}active{{end}}" href="/ioformats/">Inputs and outputs</a--> <a class="sidebar-nav-item " href="/2024/">2024 edition</a> <a class="sidebar-nav-item active" href="/2023/">2023 edition</a> </nav> <p>&copy; sisap challenge committee.</p> </div> </div> <div class="content container"> <div class=franklin-content > <h1 id=downloading_and_processing_the_original_laion2b_dataset ><a href="#downloading_and_processing_the_original_laion2b_dataset" class=header-anchor >Downloading and processing the original LAION2B dataset</a></h1> <div class=franklin-toc ><ol><li><a href="#parts">Parts</a><ol><li><a href="#metadata">Metadata</a></ol><li><a href="#downloading_the_dataset">Downloading the dataset</a><ol><li><a href="#filtering_out_nsfw_to_get_the_precise_subsets">Filtering out NSFW to get the precise subsets</a></ol></ol></div> <h2 id=parts ><a href="#parts" class=header-anchor >Parts</a></h2> <p>The LAION dataset is distributed in pairs of metadata and embeddings, bundled in parts of nearly 1 million each. Please note that the dataset contains many NSFW materials that must be discarded for our challenge, and this is made with the metadata information.</p> <h3 id=metadata ><a href="#metadata" class=header-anchor >Metadata</a></h3> <p>The metadata is publicly available through the <a href="https://laion.ai/blog/laion-5b/">LAION-5B</a> effort and the <a href="https://huggingface.co/laion">Hugging face repository</a>. </p> <h2 id=downloading_the_dataset ><a href="#downloading_the_dataset" class=header-anchor >Downloading the dataset</a></h2> <p>The embeddings are publicly available from the original mirror site <a href="https://mystic.the-eye.eu/public/AI/cah/laion5b/embeddings/">https://mystic.the-eye.eu/public/AI/cah/laion5b/embeddings/</a>.</p> <p>For instance, you can retrieve the first two parts &#40;and its associated meta data&#41; using a typical Linux installation using the terminal, as follows:</p> <pre><code class="bash hljs"><span class=hljs-built_in >mkdir</span> laion2B-en
<span class=hljs-built_in >cd</span> laion2B-en

curl -O https://mystic.the-eye.eu/public/AI/cah/laion5b/embeddings/laion2B-en/img_emb/img_emb_0000.npy
curl -O https://mystic.the-eye.eu/public/AI/cah/laion5b/embeddings/laion2B-en/laion2B-en-metadata/metadata_0000.parquet
curl -O https://mystic.the-eye.eu/public/AI/cah/laion5b/embeddings/laion2B-en/img_emb/img_emb_0001.npy
curl -O https://mystic.the-eye.eu/public/AI/cah/laion5b/embeddings/laion2B-en/laion2B-en-metadata/metadata_0001.parquet</code></pre> <p>You can download all parts using the following bash script</p> <pre><code class="bash hljs"><span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> {0000..1111}; <span class=hljs-keyword >do</span>
    <span class=hljs-built_in >echo</span> curl -O https://mystic.the-eye.eu/public/AI/cah/laion5b/embeddings/laion2B-en/img_emb/img_emb_<span class=hljs-variable >$i</span>.npy
<span class=hljs-keyword >done</span></code></pre> <p>Remove the <code>echo</code> command to actually start downloading.</p> <p>Troubleshooting: You can restart and resume partial downloads adding <code>-C -</code> to the <code>curl</code> command line, as follows:</p> <pre><code class="bash hljs">curl -C - -O https://mystic.the-eye.eu/public/AI/cah/laion5b/embeddings/laion2B-en/img_emb/img_emb_0000.npy</code></pre>
<h3 id=filtering_out_nsfw_to_get_the_precise_subsets ><a href="#filtering_out_nsfw_to_get_the_precise_subsets" class=header-anchor >Filtering out NSFW to get the precise subsets</a></h3>
<p>Each dataset part has metadata and embedding files. The metadata file is an Apache parquet table where we can find registers containing information like URL, description, and NSFW status, among other fields. Participants must use the NSFW field to obtain a mask for <em>NSFW</em> that should be used to get the desired sub-matrix. </p>
<p>The following script for the Julia language can be used for this purpose. Once you have downloaded the LAION parts and metadata, run the Julia REPL in the directory where you saved the files. The necessary packages will be asked to be installed:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> Parquet2, DataFrames, Glob, Printf, JLD2, CSV, OhMyREPL

<span class=hljs-keyword >let</span> N = <span class=hljs-number >111</span>
    D = <span class=hljs-built_in >Float16</span>[]; sizehint!(D, <span class=hljs-number >768</span> * (N * <span class=hljs-number >10</span>^<span class=hljs-number >6</span>)); L = []
    <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:N
        embfile = <span class=hljs-meta >@sprintf</span> <span class=hljs-string >&quot;img_emb_%04d.h5&quot;</span> i
        metafile = <span class=hljs-meta >@sprintf</span> <span class=hljs-string >&quot;metadata_%04d.parquet&quot;</span> i
        <span class=hljs-meta >@show</span> embfile, metafile
        df = DataFrame(Parquet2.select(Parquet2.Dataset(metafile), :caption, :NSFW, :LICENSE, :url), copycols=<span class=hljs-literal >false</span>)
        mask = [(!ismissing(r.NSFW) &amp;&amp; r.NSFW != <span class=hljs-string >&quot;NSFW&quot;</span>) <span class=hljs-keyword >for</span> r <span class=hljs-keyword >in</span> eachrow(df)]
        df = df[mask, :]
        X = jldopen(f-&gt;f[<span class=hljs-string >&quot;emb&quot;</span>], embfile)
        <span class=hljs-meta >@assert</span> size(X, <span class=hljs-number >1</span>) == <span class=hljs-number >768</span>
        <span class=hljs-meta >@assert</span> size(X, <span class=hljs-number >2</span>) == length(mask)
        length(L) == <span class=hljs-number >0</span> ? push!(L, df) : append!(L[<span class=hljs-number >1</span>], df)
        X = X[:, mask]
        append!(D, vec(X))
        <span class=hljs-meta >@show</span> N =&gt; (<span class=hljs-number >768</span>, length(D) รท <span class=hljs-number >768</span>)
        <span class=hljs-keyword >if</span> i <span class=hljs-keyword >in</span> (<span class=hljs-number >11</span>, <span class=hljs-number >33</span>, <span class=hljs-number >111</span>)
            CSV.write(<span class=hljs-string >&quot;metadata-<span class=hljs-variable >$i</span>.tsv&quot;</span>, L[<span class=hljs-number >1</span>], delim=&#x27;\t&#x27;)  <span class=hljs-comment ># you can use this file to create demos</span>
            <span class=hljs-comment ># the copy is necessary only because reshape marks the array as shared and</span>
            <span class=hljs-comment ># append! will raise errors</span>
            jldsave(<span class=hljs-string >&quot;laion2B-<span class=hljs-variable >$i</span>.h5&quot;</span>, emb=reshape(copy(D), (<span class=hljs-number >768</span>, length(D) รท <span class=hljs-number >768</span>)))
        <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span></code></pre>
<p>Package versions:</p>
<pre><code class="julia hljs">[<span class=hljs-number >336</span>ed68f] CSV v0<span class=hljs-number >.10</span><span class=hljs-number >.9</span>
  [a93c6f00] DataFrames v1<span class=hljs-number >.4</span><span class=hljs-number >.4</span>
  [c27321d9] Glob v1<span class=hljs-number >.3</span><span class=hljs-number >.0</span>
  [<span class=hljs-number >033835</span>bb] JLD2 v0<span class=hljs-number >.4</span><span class=hljs-number >.30</span>
  [<span class=hljs-number >5</span>fb14364] OhMyREPL v0<span class=hljs-number >.5</span><span class=hljs-number >.13</span>
  [<span class=hljs-number >98572</span>fba] Parquet2 v0<span class=hljs-number >.2</span><span class=hljs-number >.8</span></code></pre>
<p>Adjust <code>N</code> if necessary. Please recall that subset 10M contains 11 parts, 30M contains 33 parts, and 100M is composed of 111 parts.</p>
<div class=warn >Original LAION parts are distributed in <code>npz</code> format and you can load them with <code>numpy</code> or the <code>NPZ.jl</code> package when you work with Julia.</div>
<div class=page-foot >
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> sisap challenge committee. Last modified: February 21, 2025.
    Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
</div>
</div>
    </div>  
    
    
        <script src="/libs/highlight/highlight.min.js"></script>
<script>hljs.highlightAll();hljs.configure({tabReplace: '    '});</script>